{"autoSize":{"author":null,"declares":{"name":"autoSize","parameters":[{"name":"dims","text":null},{"name":"padding","text":null},{"name":"scale","text":"1"},{"name":"is.multiple.combine.wide","text":"FALSE"},{"name":"ratio.threshold","text":"1.25"},{"name":"ratio.scale","text":"1.5"}],"sourceMap":{"File":"layout.R","Line":"33","Method":{"Method":"autoSize","Module":"declare_function","Namespace":"SMRUCC\/R#"}}},"description":"","details":"","examples":null,"keywords":[],"parameters":[{"name":"dims","text":"The dimensions of MSImaging raw data. Can be either: 1. A numeric vector with at least two elements representing [width, height] 2. A list object containing at least two named elements \"w\" and \"h\"."},{"name":"padding","text":"A numeric vector specifying CSS-style padding in the order: [top, right, bottom, left]. Defines empty space around the imaging data."},{"name":"scale","text":"Numeric scaling factor for pixel dimensions (default: 1). Values >1 enlarge, <1 shrink while maintaining original proportions."},{"name":"is_multiple_combine_wide","text":"Logical indicating if wide-format multi-sample layout should be prioritized (default: FALSE). When FALSE, attempts to maintain 1:1 aspect ratio by applying ratio scaling when needed."},{"name":"ratio_threshold","text":"Numeric threshold for aspect ratio adjustment (default: 1.25). Triggers dimension scaling when width\/height ratio exceeds this value."},{"name":"ratio_scale","text":"Multiplicative factor (default: 1.5) applied to under-dimensioned axis when aspect ratio exceeds threshold."}],"returns":"A list containing: \\itemize{ \\item size - Numeric vector [width, height] of recommended canvas dimensions \\item scale - Applied scaling factors (if any) }","see_also":null,"title":"Calculate recommended canvas size for MSImaging visualization Automatically evaluates appropriate canvas dimensions considering padding, scaling, and aspect ratio adjustments for multi-sample imaging displays."},"geom_red":{"author":null,"declares":{"name":"geom_red","parameters":[{"name":"mz","text":null},{"name":"tolerance","text":"'getOption'('mzdiff', 'default' = 'da:0.3')"}],"sourceMap":{"File":"MSImaging.R","Line":"18","Method":{"Method":"geom_red","Module":"declare_function","Namespace":"SMRUCC\/R#"}}},"description":"","details":"","examples":null,"keywords":[],"parameters":[{"name":"mz","text":"numeric. The target mass-to-charge ratio (m\/z) value for ion detection."},{"name":"tolerance","text":"character or numeric. Mass accuracy tolerance in Dalton (Da) format. Default uses option \"mzdiff\" if set, otherwise \"da:0.3\". Format should follow \"da:[value]\" for Dalton-based tolerance or \"ppm:[value]\" for parts-per-million."}],"returns":"A ggplot2 layer object that can be added to existing MSI plots for multi-channel visualization. Displays ion distribution in red color scale.","see_also":null,"title":"Create red channel MS imaging layer Generates a ggplot2 layer for mass spectrometry imaging (MSI) data visualization in red color channel corresponding to specified m\/z value."},"geom_green":{"author":null,"declares":{"name":"geom_green","parameters":[{"name":"mz","text":null},{"name":"tolerance","text":"'getOption'('mzdiff', 'default' = 'da:0.3')"}],"sourceMap":{"File":"MSImaging.R","Line":"36","Method":{"Method":"geom_green","Module":"declare_function","Namespace":"SMRUCC\/R#"}}},"description":"","details":"","examples":null,"keywords":[],"parameters":[{"name":"mz","text":"numeric. The target mass-to-charge ratio (m\/z) value for ion detection."},{"name":"tolerance","text":"character or numeric. Mass accuracy tolerance. See geom_red() for format details."}],"returns":"A ggplot2 layer object displaying ion distribution in green color scale.","see_also":null,"title":"Create green channel MS imaging layer Generates a ggplot2 layer for mass spectrometry imaging (MSI) data visualization in green color channel corresponding to specified m\/z value."},"geom_blue":{"author":null,"declares":{"name":"geom_blue","parameters":[{"name":"mz","text":null},{"name":"tolerance","text":"'getOption'('mzdiff', 'default' = 'da:0.3')"}],"sourceMap":{"File":"MSImaging.R","Line":"54","Method":{"Method":"geom_blue","Module":"declare_function","Namespace":"SMRUCC\/R#"}}},"description":"","details":"","examples":null,"keywords":[],"parameters":[{"name":"mz","text":"numeric. The target mass-to-charge ratio (m\/z) value for ion detection."},{"name":"tolerance","text":"character or numeric. Mass accuracy tolerance. See geom_red() for format details."}],"returns":"A ggplot2 layer object displaying ion distribution in blue color scale.","see_also":null,"title":"Create blue channel MS imaging layer Generates a ggplot2 layer for mass spectrometry imaging (MSI) data visualization in blue color channel corresponding to specified m\/z value."},"geom_blanket":{"author":null,"declares":{"name":"geom_blanket","parameters":[{"name":"mz","text":null},{"name":"tolerance","text":"'getOption'('mzdiff', 'default' = 'da:0.3')"}],"sourceMap":{"File":"MSImaging.R","Line":"73","Method":{"Method":"geom_blanket","Module":"declare_function","Namespace":"SMRUCC\/R#"}}},"description":"","details":"","examples":null,"keywords":[],"parameters":[{"name":"mz","text":"numeric. The target mass-to-charge ratio (m\/z) value for ion detection."},{"name":"tolerance","text":"character or numeric. Mass accuracy tolerance. See geom_red() for format details."}],"returns":"A ggplot2 layer object using \"Greys\" color palette with alpha channel (c8 = 200\/255 transparency) suitable for creating intensity-normalized backgrounds or composite overlays.","see_also":null,"title":"Create monochromatic overlay for MS imaging Generates a grayscale ggplot2 layer for mass spectrometry imaging (MSI) data, typically used as a background layer or for intensity normalization."},"PlotMSIMatrixHeatmap":{"author":null,"declares":{"name":"PlotMSIMatrixHeatmap","parameters":[{"name":"ions.data","text":null},{"name":"layout","text":"[3, 3]"},{"name":"colorSet","text":"'Jet'"},{"name":"MSI.TrIQ","text":"0.8"},{"name":"gaussian","text":"3"},{"name":"size","text":"[2700, 2000]"},{"name":"canvasPadding","text":"[50, 300, 50, 50]"},{"name":"cellPadding","text":"[200, 100, 0, 100]"},{"name":"font.size","text":"27"},{"name":"filters","text":"NULL"},{"name":"strict","text":"TRUE"},{"name":"msi.dimension","text":"NULL"}],"sourceMap":{"File":"MSIMatrixHeatmapGroupPlot.R","Line":"60","Method":{"Method":"PlotMSIMatrixHeatmap","Module":"declare_function","Namespace":"SMRUCC\/R#"}}},"description":"","details":"Key processing steps: \\enumerate{ \\item Applies intensity filtering (default or custom) to all ion layers \\item Generates grid layout with specified cell\/canvas padding \\item Renders color legend using selected palette \\item Draws each ion heatmap with optional Gaussian smoothing \\item Adds formatted multi-line labels below each heatmap: \\itemize{ \\item{Line 1: Metabolite name (auto-wrapped at 32 characters)} \\item{Line 2: Precursor type (from `type` slot)} \\item{Line 3: m\/z value formatted to 3 decimal places} } }","examples":null,"keywords":[],"parameters":[{"name":"ions_data","text":"A list of MSI layer data. Each element must be a list containing: \\itemize{ \\item{type: Character string specifying precursor type (e.g., \"[M+H]+\")} \\item{title: Character string of metabolite\/ion name for labeling} \\item{layer: Matrix or raster object containing spatial intensity data} \\item{mz: Numeric m\/z value of target ion (used in label generation)} }"},{"name":"filters","text":"Optional custom intensity filter(s) for raster data preprocessing. If NULL (default), applies Top x% Intensity Quantile (TrIQ) filtering via `MSI_TrIQ`."},{"name":"layout","text":"Integer vector of length 2 specifying grid dimensions [rows, columns]. Default: [3,3]."},{"name":"colorSet","text":"Character specifying color palette name (e.g., \"Jet\", \"viridis\"). Default: \"Jet\"."},{"name":"MSI_TrIQ","text":"Numeric [0-1] specifying Top x% Intensity Quantile threshold for default intensity filtering. Values > threshold are clipped. Default: 0.8."},{"name":"gaussian","text":"Numeric specifying Gaussian blur radius (in pixels) for spatial smoothing. Set to 0 to disable. Default: 3."},{"name":"size","text":"Integer vector of length 2 specifying canvas dimensions [width, height] in pixels. Default: [2700, 2000]."},{"name":"canvasPadding","text":"Integer vector of length 4 specifying canvas margins [top, right, bottom, left] in pixels. Default: [50, 300, 50, 50]."},{"name":"cellPadding","text":"Integer vector of length 4 specifying grid cell margins [top, right, bottom, left] in pixels. Default: [200, 100, 0, 100]."},{"name":"font_size","text":"Numeric specifying base font size for labels. Default: 27."},{"name":"strict","text":"Logical. If TRUE, enforces dimension consistency checks. Default: TRUE."},{"name":"msi_dimension","text":"Optional integer vector of length 2 specifying output dimensions [width, height] for rasterization. If NULL, uses native data dimensions."}],"returns":"Invisibly returns NULL. Generates a composite plot in the active graphics device containing: \\itemize{ \\item{Grid of MSI heatmaps with Gaussian smoothing} \\item{Color legend using specified palette} \\item{Metabolite labels with split formatting (name, precursor type, m\/z)} }","see_also":null,"title":"Plot MS-Imaging Heatmap Matrix in Grid Layout Generates a matrix of mass spectrometry imaging (MSI) heatmaps in grid layout with intensity filtering, spatial smoothing, and formatted metabolite labels. Supports custom color schemes, layout configurations, and intensity filters."},"MSI_ionStatPlot":{"author":null,"declares":{"name":"MSI_ionStatPlot","parameters":[{"name":"mzpack","text":null},{"name":"mz","text":null},{"name":"met","text":null},{"name":"sampleinfo","text":null},{"name":"savePng","text":"'.\/Rplot.png'"},{"name":"ionName","text":"NULL"},{"name":"size","text":"[2400, 1000]"},{"name":"colorMap","text":"NULL"},{"name":"MSI.colorset","text":"'viridis:turbo'"},{"name":"ggStatPlot","text":"NULL"},{"name":"padding.top","text":"150"},{"name":"padding.right","text":"200"},{"name":"padding.bottom","text":"150"},{"name":"padding.left","text":"150"},{"name":"interval","text":"50"},{"name":"combine.layout","text":"[4, 5]"},{"name":"jitter.size","text":"8"},{"name":"TrIQ","text":"0.65"},{"name":"backcolor","text":"'black'"},{"name":"regions","text":"NULL"}],"sourceMap":{"File":"MSI_ionStatPlot.R","Line":"71","Method":{"Method":"MSI_ionStatPlot","Module":"declare_function","Namespace":"SMRUCC\/R#"}}},"description":"","details":"The function performs three main operations: 1. Computes ANOVA group statistics using \\code{ANOVAGroup()} 2. Creates a statistical plot (bar\/box\/violin) with significance annotations 3. Generates MS ion image with optional spatial region overlays Plots are combined using a customizable split-layout system. Statistical tests include: - ANOVA global test (displayed in plot) - Pairwise t-tests against global mean (p-value symbols)","examples":null,"keywords":[],"parameters":[{"name":"mzpack","text":"An mzpack object containing MS imaging data and layer information. Must be compatible with ggplot MS imaging functions."},{"name":"mz","text":"Target ion mass-to-charge ratio (m\/z) value for imaging."},{"name":"met","text":"List containing sample intensity data. List keys should be sample IDs with corresponding intensity values."},{"name":"sampleinfo","text":"Metadata list defining sample groups and visualization properties. Requires: \\itemize{ \\item \\code{group}: Character vector of group names (plot titles) \\item \\code{id}: Character vector of sample IDs corresponding to \\code{met} keys \\item \\code{color}: HTML color codes for each group's statistical plot elements }"},{"name":"savePng","text":"Output file path for PNG image. Default: \".\/Rplot.png\"."},{"name":"ionName","text":"Display title for the ion. Uses m\/z value when \\code{NULL} (default)."},{"name":"size","text":"Image dimensions in pixels [width, height]. Default: \\code{c(2400, 1000)}."},{"name":"colorMap","text":"Named list mapping group names to custom colors (overrides \\code{sampleinfo$color})."},{"name":"MSI_colorset","text":"Color palette for MS imaging. Default: \"viridis:turbo\"."},{"name":"ggStatPlot","text":"Statistical plot geometry function. Default: bar plot (\\code{geom_barplot})."},{"name":"padding_top","text":"Top padding in pixels. Default: 150."},{"name":"padding_right","text":"Right padding in pixels. Default: 200."},{"name":"padding_bottom","text":"Bottom padding in pixels. Default: 150."},{"name":"padding_left","text":"Left padding in pixels. Default: 150."},{"name":"interval","text":"Spacing between statistical plot and MS image in pixels. Default: 50."},{"name":"combine_layout","text":"Layout ratio [stat_plot_width, msi_width]. Default: \\code{c(4, 5)} (converted to 44.4% vs 55.6% of available width)."},{"name":"jitter_size","text":"Point size for jittered data points. Default: 8."},{"name":"TrIQ","text":"Intensity quantile threshold (0-1) for MS image enhancement. Default: 0.65."},{"name":"backcolor","text":"Background color for MS imaging panel. Default: \"black\"."},{"name":"regions","text":"Optional list with spatial coordinates to overlay on MS image: \\itemize{ \\item \\code{x}: X-coordinates vector \\item \\code{y}: Y-coordinates vector \\item \\code{colors}: Corresponding colors vector }"}],"returns":null,"see_also":null,"title":"Combined Statistical Plot and Mass Spectrometry Imaging Visualization Generates a composite visualization combining statistical charts (e.g., bar\/box\/violin plots) with mass spectrometry imaging (MSI) data. Outputs to specified PNG file with customizable layout."},"npixels":{"author":null,"declares":{"name":"npixels","parameters":[{"name":"raw","text":null}],"sourceMap":{"File":"utils.R","Line":"28","Method":{"Method":"npixels","Module":"declare_function","Namespace":"SMRUCC\/R#"}}},"description":"","details":"The function accesses the MS property of the mzpack object, which stores a list of MS scans, and returns the count of MS1-level scans. In MS imaging, each MS1 scan is spatially mapped to a specific (x,y) coordinate, forming the basis for intensity-based image reconstruction.","examples":null,"keywords":[],"parameters":[{"name":"raw","text":"An mzpack object containing mass spectrometry data. The object must include MS1-level scan data in its MS property. Typically generated by mzR or other MS data parsers that support imaging data structure."}],"returns":"An integer value representing the total number of pixels in the associated MS imaging experiment. This is equivalent to the number of MS1 scans stored in the MS property of the input object.","see_also":null,"title":"Count the number of MS1 scans as imaging pixels This function calculates the total number of MS1 scans in an mzpack object, which corresponds to the pixel dimensions in MS imaging spatial data. Each MS1 scan represents a spatial coordinate (pixel) in the 2D imaging plane."},".auto_size_internal":{"author":null,"declares":{"name":".auto_size_internal","parameters":[{"name":"dims","text":null},{"name":"padding","text":null},{"name":"scale","text":"1"}],"sourceMap":{"File":"utils.R","Line":"44","Method":{"Method":".auto_size_internal","Module":"declare_function","Namespace":"SMRUCC\/R#"}}},"description":"","details":"","examples":null,"keywords":["internal"],"parameters":[{"name":"dims","text":"Original image dimensions (numeric vector [width, height])"},{"name":"padding","text":"Numeric vector specifying padding [top, right, bottom, left]"},{"name":"scale","text":"Numeric scaling factor for initial dimension adjustment"}],"returns":"Numeric vector [width, height] representing: (original dimensions * scale) + padding adjustments","see_also":null,"title":"Internal canvas dimension calculator Helper function that computes base canvas dimensions with padding and scaling."},".onLoad":{"author":null,"declares":{"name":".onLoad","parameters":[],"sourceMap":{"File":"zzz.R","Line":"7","Method":{"Method":".onLoad","Module":"declare_function","Namespace":"SMRUCC\/R#"}}},"description":null,"details":null,"examples":null,"keywords":null,"parameters":null,"returns":null,"see_also":null,"title":".onLoad"},"default_intensity_filter":{"author":null,"declares":{"name":"default_intensity_filter","parameters":[{"name":"ion","text":null},{"name":"MSI.TrIQ","text":"0.8"}],"sourceMap":{"File":"custom.R","Line":"36","Method":{"Method":"default_intensity_filter","Module":"declare_function","Namespace":"SMRUCC\/R#"}}},"description":"Processes an ion layer through a predefined sequence of intensity correction steps including gap filling, spatial smoothing, and intensity range truncation using Trimmed Quantile Scaling (TrIQ).","details":"Processing workflow: 1. ​**kNN Imputation**: Fills missing values using \\code{knnFill()} 2. ​**Spatial Smoothing**: Applies \\code{soften_scale()} for edge-preserving smoothing 3. ​**TrIQ Scaling**: Calculates intensity thresholds with \\code{TrIQ()} 4. ​**Intensity Truncation**: Limits layer values using \\code{intensityLimits()} The modified `ion` object will contain: - Processed `layer` raster with adjusted intensities - Calculated `TrIQ` values stored in the object","examples":null,"keywords":[],"parameters":[{"name":"ion","text":"An `ion` object containing MSI data with at least a `layer` component (raster data) and `TrIQ` field for storing scaling factors."},{"name":"MSI_TrIQ","text":"Quantile threshold (0-1) for intensity truncation. Default 0.8 (retains intensities below 80th percentile)."}],"returns":"Modified `ion` object with updated `layer` and `TrIQ` components.","see_also":null,"title":"Apply Default Intensity Filtering Pipeline to MSI Ion Layer"},"custom_intensity_filter":{"author":null,"declares":{"name":"custom_intensity_filter","parameters":[{"name":"ion","text":null},{"name":"filters","text":null},{"name":"MSI.TrIQ","text":"0.8"}],"sourceMap":{"File":"custom.R","Line":"70","Method":{"Method":"custom_intensity_filter","Module":"declare_function","Namespace":"SMRUCC\/R#"}}},"description":"Processes an ion layer using user-defined raster filters followed by automatic intensity scaling through Trimmed Quantile Scaling (TrIQ).","details":"Key features: - Allows custom filter sequences via \\code{apply_raster_filter()} - Maintains automatic TrIQ scaling after custom filtering - Preserves original object structure while updating `layer` and `TrIQ`","examples":null,"keywords":[],"parameters":[{"name":"ion","text":"An `ion` object containing MSI data with `layer` raster data"},{"name":"filters","text":"List of raster filters to apply in sequence (function objects)"},{"name":"MSI_TrIQ","text":"Quantile threshold for intensity truncation (default 0.8)"}],"returns":"Modified `ion` object with filtered `layer` and updated `TrIQ` values","see_also":null,"title":"Apply Custom Filter Sequence to MSI Ion Layer"},"default_MSIfilter":{"author":null,"declares":{"name":"default_MSIfilter","parameters":[],"sourceMap":{"File":"default_MSIfilter.R","Line":"44","Method":{"Method":"default_MSIfilter","Module":"declare_function","Namespace":"SMRUCC\/R#"}}},"description":"Generates a predefined pipeline of geometric filters optimized for preprocessing single ion mass spectrometry imaging (MSI) data. This pipeline combines multiple image enhancement steps in a recommended sequence.","details":"The filter pipeline is constructed using the following processing steps in sequence: \\enumerate{ \\item \\code{denoise_scale()}: Applies initial noise reduction to raw MSI data \\item \\code{TrIQ_scale(0.99)}: Performs trimmed quantile scaling (top 1% truncated) \\item \\code{knn_scale()}: Executes k-nearest neighbors smoothing \\item \\code{soften_scale()}: Final edge-preserving image softening } The 'greater than' operator (>) is used to define processing order in this domain-specific language. Filters are applied from left to right.","examples":null,"keywords":[],"parameters":[],"returns":"A filter pipeline object of class 'geometric_filters' containing the configured processing sequence. This object can be used with MSI processing functions that accept geometric filter pipelines.","see_also":null,"title":"Create Default Filter Pipeline for Single Ion Mass Spectrometry Imaging"}}